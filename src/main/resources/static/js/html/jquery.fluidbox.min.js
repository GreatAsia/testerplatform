!function(e,t){var i,n=e.jQuery||e.Cowboy||(e.Cowboy={});n.throttle=i=function(e,i,o,s){function a(){function n(){d=+new Date,o.apply(l,f)}function a(){r=t}var l=this,c=+new Date-d,f=arguments;s&&!r&&n(),r&&clearTimeout(r),s===t&&c>e?n():!0!==i&&(r=setTimeout(s?a:n,s===t?e-c:e))}var r,d=0;return"boolean"!=typeof i&&(s=o,o=i,i=t),n.guid&&(a.guid=o.guid=o.guid||n.guid++),a},n.debounce=function(e,n,o){return o===t?i(e,n,!1):i(e,o,!1!==n)}}(this),function(e,t,i,n){"use strict";function o(t,i){this.element=t;var n={};e.each(e(this.element).data(),function(e,t){var i=function(e){return e&&e[0].toLowerCase()+e.slice(1)}(e.replace("fluidbox",""));(""!==i||null!==i)&&("false"==t?t=!1:"true"==t&&(t=!0),n[i]=t)}),this.settings=e.extend({},r,i,n),this.settings.viewportFill=Math.max(Math.min(parseFloat(this.settings.viewportFill),1),0),this.settings.stackIndex<this.settings.stackIndexDelta&&(settings.stackIndexDelta=settings.stackIndex),this._name=a,this.init()}var s=e(t),a=(e(i),"fluidbox"),r={immediateOpen:!1,loader:!1,maxWidth:0,maxHeight:0,resizeThrottle:500,stackIndex:1e3,stackIndexDelta:10,viewportFill:.95},d={},l=0;("undefined"==typeof console||"undefined"===console.warn)&&(console={},console.warn=function(){}),e.isFunction(e.throttle)||console.warn("Fluidbox: The jQuery debounce/throttle plugin is not found/loaded. Even though Fluidbox works without it, the window resize event will fire extremely rapidly in browsers, resulting in significant degradation in performance upon viewport resize.");var c=function(){var e,t=i.createElement("fakeelement"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in o)if(t.style[e]!==n)return o[e]}(),f={dom:function(){var t=e("<div />",{class:"fluidbox__wrap",css:{zIndex:this.settings.stackIndex-this.settings.stackIndexDelta}});if(e(this.element).addClass("fluidbox--closed").wrapInner(t).find("img").first().css({opacity:1}).addClass("fluidbox__thumb").after('<div class="fluidbox__ghost" />'),this.settings.loader){var i=e("<div />",{class:"fluidbox__loader",css:{zIndex:2}});e(this.element).find(".fluidbox__wrap").append(i)}},prepareFb:function(){var t=this,i=e(this.element);i.trigger("thumbloaddone.fluidbox"),f.measure.fbElements.call(this),t.bindEvents(),i.addClass("fluidbox--ready"),t.bindListeners(),i.trigger("ready.fluidbox")},measure:{viewport:function(){d.viewport={w:s.width(),h:s.height()}},fbElements:function(){var t=this,i=e(this.element),n=i.find("img").first(),o=i.find(".fluidbox__ghost"),s=i.find(".fluidbox__wrap");t.instanceData.thumb={natW:n[0].naturalWidth,natH:n[0].naturalHeight,w:n.width(),h:n.height()},o.css({width:n.width(),height:n.height(),top:n.offset().top-s.offset().top+parseInt(n.css("borderTopWidth"))+parseInt(n.css("paddingTop")),left:n.offset().left-s.offset().left+parseInt(n.css("borderLeftWidth"))+parseInt(n.css("paddingLeft"))})}},checkURL:function(e){var t=0;return/[\s+]/g.test(e)?(console.warn("Fluidbox: Fluidbox opening is halted because it has detected characters in your URL string that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation."),t=1):/[\"\'\(\)]/g.test(e)&&(console.warn("Fluidbox: Fluidbox opening will proceed, but it has detected characters in your URL string that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation."),t=0),t},formatURL:function(e){return e.replace(/"/g,"%22").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}};e.extend(o.prototype,{init:function(){var t=this,i=e(this.element),n=i.find("img").first();if(f.measure.viewport(),(!t.instanceData||!t.instanceData.initialized)&&i.is("a")&&1===i.children().length&&(i.children().is("img")||i.children().is("picture")&&1===i.find("img").length)&&"none"!==i.css("display")&&"none"!==i.children().css("display")&&"none"!==i.parents().css("display")){i.removeClass("fluidbox--destroyed"),t.instanceData={},t.instanceData.initialized=!0,t.instanceData.originalNode=i.html(),l+=1,t.instanceData.id=l,i.addClass("fluidbox__instance-"+l),i.addClass("fluidbox--initialized"),f.dom.call(t),i.trigger("init.fluidbox");var o=new Image;n.width()>0&&n.height()>0?f.prepareFb.call(t):(o.onload=function(){f.prepareFb.call(t)},o.onerror=function(){i.trigger("thumbloadfail.fluidbox")},o.src=n.attr("src"))}},open:function(){var t=this,i=e(this.element),n=i.find("img").first(),o=i.find(".fluidbox__ghost"),s=i.find(".fluidbox__wrap");t.instanceData.state=1,o.off(c),e(".fluidbox--opened").fluidbox("close");var a=e("<div />",{class:"fluidbox__overlay",css:{zIndex:-1}});if(s.append(a),i.removeClass("fluidbox--closed").addClass("fluidbox--loading"),f.checkURL(n.attr("src")))return t.close(),!1;o.css({"background-image":"url("+f.formatURL(n.attr("src"))+")",opacity:1}),f.measure.fbElements.call(t);var r;t.settings.immediateOpen?(i.addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:t.settings.stackIndex+t.settings.stackIndexDelta}),i.trigger("openstart.fluidbox"),t.compute(),n.css({opacity:0}),e(".fluidbox__overlay").css({opacity:1}),o.one(c,function(){i.trigger("openend.fluidbox")}),r=new Image,r.onload=function(){if(i.trigger("imageloaddone.fluidbox"),1===t.instanceData.state){if(t.instanceData.thumb.natW=r.naturalWidth,t.instanceData.thumb.natH=r.naturalHeight,i.removeClass("fluidbox--loading"),f.checkURL(r.src))return t.close({error:!0}),!1;o.css({"background-image":"url("+f.formatURL(r.src)+")"}),t.compute()}},r.onerror=function(){t.close({error:!0}),i.trigger("imageloadfail.fluidbox"),i.trigger("delayedloadfail.fluidbox")},r.src=i.attr("href")):(r=new Image,r.onload=function(){return i.trigger("imageloaddone.fluidbox"),i.removeClass("fluidbox--loading").addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:t.settings.stackIndex+t.settings.stackIndexDelta}),i.trigger("openstart.fluidbox"),f.checkURL(r.src)?(t.close({error:!0}),!1):(o.css({"background-image":"url("+f.formatURL(r.src)+")"}),t.instanceData.thumb.natW=r.naturalWidth,t.instanceData.thumb.natH=r.naturalHeight,t.compute(),n.css({opacity:0}),e(".fluidbox__overlay").css({opacity:1}),void o.one(c,function(){i.trigger("openend.fluidbox")}))},r.onerror=function(){t.close({error:!0}),i.trigger("imageloadfail.fluidbox")},r.src=i.attr("href"))},compute:function(){var t=this,i=e(this.element),n=i.find("img").first(),o=i.find(".fluidbox__ghost"),a=i.find(".fluidbox__wrap"),r=t.instanceData.thumb.natW,l=t.instanceData.thumb.natH,c=t.instanceData.thumb.w,f=t.instanceData.thumb.h,u=r/l,p=d.viewport.w/d.viewport.h;t.settings.maxWidth>0?(r=t.settings.maxWidth,l=r/u):t.settings.maxHeight>0&&(l=t.settings.maxHeight,r=l*u);var h,g,b,x,m;p>u?(h=l<d.viewport.h?l:d.viewport.h*t.settings.viewportFill,b=h/f,x=r*(f*b/l)/c,m=b):(g=r<d.viewport.w?r:d.viewport.w*t.settings.viewportFill,x=g/c,b=l*(c*x/r)/f,m=x),t.settings.maxWidth&&t.settings.maxHeight&&console.warn("Fluidbox: Both maxHeight and maxWidth are specified. You can only specify one. If both are specified, only the maxWidth property will be respected. This will not generate any error, but may cause unexpected sizing behavior.");var v=s.scrollTop()-n.offset().top+f*(m-1)*.5+.5*(s.height()-f*m),w=c*(m-1)*.5+.5*(s.width()-c*m)-n.offset().left,y=parseInt(100*x)/100+","+parseInt(100*b)/100;o.css({transform:"translate("+parseInt(100*w)/100+"px,"+parseInt(100*v)/100+"px) scale("+y+")",top:n.offset().top-a.offset().top,left:n.offset().left-a.offset().left}),i.find(".fluidbox__loader").css({transform:"translate("+parseInt(100*w)/100+"px,"+parseInt(100*v)/100+"px) scale("+y+")"}),i.trigger("computeend.fluidbox")},recompute:function(){this.compute()},close:function(t){var i=this,o=e(this.element),s=o.find("img").first(),a=o.find(".fluidbox__ghost"),r=o.find(".fluidbox__wrap"),d=o.find(".fluidbox__overlay"),l=e.extend(null,{error:!1},t);return null!==i.instanceData.state&&typeof i.instanceData.state!=typeof n&&0!==i.instanceData.state&&(i.instanceData.state=0,o.trigger("closestart.fluidbox"),o.removeClass(function(e,t){return(t.match(/(^|\s)fluidbox--(opened|loaded|loading)+/g)||[]).join(" ")}).addClass("fluidbox--closed"),a.css({transform:"translate(0,0) scale(1,1)",top:s.offset().top-r.offset().top+parseInt(s.css("borderTopWidth"))+parseInt(s.css("paddingTop")),left:s.offset().left-r.offset().left+parseInt(s.css("borderLeftWidth"))+parseInt(s.css("paddingLeft"))}),o.find(".fluidbox__loader").css({transform:"none"}),a.one(c,function(){a.css({opacity:0}),s.css({opacity:1}),d.remove(),r.css({zIndex:i.settings.stackIndex-i.settings.stackIndexDelta}),o.trigger("closeend.fluidbox")}),l.error&&a.trigger("transitionend"),void d.css({opacity:0}))},bindEvents:function(){var t=this;e(this.element).on("click.fluidbox",function(e){e.preventDefault(),t.instanceData.state&&0!==t.instanceData.state?t.close():t.open()})},bindListeners:function(){var t=this,i=e(this.element),n=function(){f.measure.viewport(),f.measure.fbElements.call(t),i.hasClass("fluidbox--opened")&&t.compute()};e.isFunction(e.throttle)?s.on("resize.fluidbox"+t.instanceData.id,e.throttle(t.settings.resizeThrottle,n)):s.on("resize.fluidbox"+t.instanceData.id,n),i.on("reposition.fluidbox",function(){t.reposition()}),i.on("recompute.fluidbox, compute.fluidbox",function(){t.compute()}),i.on("destroy.fluidbox",function(){t.destroy()}),i.on("close.fluidbox",function(){t.close()})},unbind:function(){e(this.element).off("click.fluidbox reposition.fluidbox recompute.fluidbox compute.fluidbox destroy.fluidbox close.fluidbox"),s.off("resize.fluidbox"+this.instanceData.id)},reposition:function(){f.measure.fbElements.call(this)},destroy:function(){var t=this.instanceData.originalNode;this.unbind(),e.data(this.element,"plugin_"+a,null),e(this.element).removeClass(function(e,t){return(t.match(/(^|\s)fluidbox[--|__]\S+/g)||[]).join(" ")}).empty().html(t).addClass("fluidbox--destroyed").trigger("destroyed.fluidbox")},getMetadata:function(){return this.instanceData}}),e.fn[a]=function(t){var i=arguments;if(t===n||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+a)||e.data(this,"plugin_"+a,new o(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var s;return this.each(function(){var n=e.data(this,"plugin_"+a);n instanceof o&&"function"==typeof n[t]?s=n[t].apply(n,Array.prototype.slice.call(i,1)):console.warn('Fluidbox: The method "'+t+'" used is not defined in Fluidbox. Please make sure you are calling the correct public method.')}),s!==n?s:this}return this}}(jQuery,window,document);